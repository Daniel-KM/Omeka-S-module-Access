CREATE TABLE `access_request` (
    `id` INT AUTO_INCREMENT NOT NULL,
    `resource_id` INT NOT NULL,
    `user_id` INT NOT NULL,
    `status` VARCHAR(8) DEFAULT 'new' NOT NULL,
    `created` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL,
    `modified` DATETIME DEFAULT NULL,
    INDEX IDX_F3B2558A89329D25 (`resource_id`),
    INDEX IDX_F3B2558AA76ED395 (`user_id`),
    PRIMARY KEY(`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;

CREATE TABLE `access_log` (
    `id` INT AUTO_INCREMENT NOT NULL,
    `user_id` INT NOT NULL,
    `action` VARCHAR(31) NOT NULL,
    `record_id` INT NOT NULL,
    `type` VARCHAR(7) NOT NULL,
    `date` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL,
    PRIMARY KEY(`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;

CREATE TABLE `access_resource` (
    `id` INT AUTO_INCREMENT NOT NULL,
    `resource_id` INT NOT NULL,
    `user_id` INT DEFAULT NULL,
    `token` VARCHAR(32) DEFAULT NULL,
    `enabled` TINYINT(1) DEFAULT '0' NOT NULL,
    `temporal` TINYINT(1) DEFAULT '0' NOT NULL,
    `start_date` DATETIME DEFAULT NULL,
    `end_date` DATETIME DEFAULT NULL,
    `created` DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL,
    `modified` DATETIME DEFAULT NULL,
    INDEX IDX_D184352789329D25 (`resource_id`),
    INDEX IDX_D1843527A76ED395 (`user_id`),
    PRIMARY KEY(`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;

CREATE TABLE `access_status` (
    `id` INT NOT NULL,
    `status` VARCHAR(15) NOT NULL,
    `embargo_start` DATETIME DEFAULT NULL,
    `embargo_end` DATETIME DEFAULT NULL,
    INDEX IDX_898BF02E7B00651C (`status`),
    PRIMARY KEY(`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE `utf8mb4_unicode_ci` ENGINE = InnoDB;

ALTER TABLE `access_request` ADD CONSTRAINT FK_F3B2558A89329D25 FOREIGN KEY (`resource_id`) REFERENCES `resource` (`id`) ON DELETE CASCADE;
ALTER TABLE `access_request` ADD CONSTRAINT FK_F3B2558AA76ED395 FOREIGN KEY (`user_id`) REFERENCES `user` (`id`) ON DELETE CASCADE;
ALTER TABLE `access_resource` ADD CONSTRAINT FK_D184352789329D25 FOREIGN KEY (`resource_id`) REFERENCES `resource` (`id`) ON DELETE CASCADE;
ALTER TABLE `access_resource` ADD CONSTRAINT FK_D1843527A76ED395 FOREIGN KEY (`user_id`) REFERENCES `user` (`id`) ON DELETE SET NULL;
ALTER TABLE `access_status` ADD CONSTRAINT FK_898BF02EBF396750 FOREIGN KEY (`id`) REFERENCES `resource` (`id`) ON DELETE CASCADE;
